{"version":3,"sources":["../../../src/pages/ClerkProvider.tsx"],"sourcesContent":["import { __internal__setErrorThrowerOptions, ClerkProvider as ReactClerkProvider } from '@clerk/clerk-react';\nimport { useRouter } from 'next/router';\nimport React from 'react';\n\nimport { ClerkNextOptionsProvider } from '../client-boundary/NextOptionsContext';\nimport { useSafeLayoutEffect } from '../client-boundary/useSafeLayoutEffect';\nimport type { NextClerkProviderProps } from '../types';\nimport { invalidateNextRouterCache } from '../utils/invalidateNextRouterCache';\nimport { mergeNextClerkPropsWithEnv } from '../utils/mergeNextClerkPropsWithEnv';\n\n__internal__setErrorThrowerOptions({ packageName: '@clerk/nextjs' });\n\nexport function ClerkProvider({ children, ...props }: NextClerkProviderProps): JSX.Element {\n  const { __unstable_invokeMiddlewareOnAuthStateChange = true } = props;\n  const { push } = useRouter();\n  ReactClerkProvider.displayName = 'ReactClerkProvider';\n\n  useSafeLayoutEffect(() => {\n    window.__unstable__onBeforeSetActive = invalidateNextRouterCache;\n  }, []);\n\n  useSafeLayoutEffect(() => {\n    window.__unstable__onAfterSetActive = () => {\n      // Re-run the middleware every time there auth state changes.\n      // This enables complete control from a centralised place (NextJS middleware),\n      // as we will invoke it every time the client-side auth state changes, eg: signing-out, switching orgs, etc.\\\n      if (__unstable_invokeMiddlewareOnAuthStateChange) {\n        void push(window.location.href);\n      }\n    };\n  }, []);\n\n  const navigate = (to: string) => push(to);\n  const mergedProps = mergeNextClerkPropsWithEnv({ ...props, navigate });\n  // withServerSideAuth automatically injects __clerk_ssr_state\n  // getAuth returns a user-facing authServerSideProps that hides __clerk_ssr_state\n  // @ts-expect-error initialState is hidden from the types as it's a private prop\n  const initialState = props.authServerSideProps?.__clerk_ssr_state || props.__clerk_ssr_state;\n\n  return (\n    <ClerkNextOptionsProvider options={mergedProps}>\n      {/*@ts-expect-error*/}\n      <ReactClerkProvider\n        {...mergedProps}\n        initialState={initialState}\n      >\n        {children}\n      </ReactClerkProvider>\n    </ClerkNextOptionsProvider>\n  );\n}\n"],"mappings":"AAAA,SAAS,oCAAoC,iBAAiB,0BAA0B;AACxF,SAAS,iBAAiB;AAC1B,OAAO,WAAW;AAElB,SAAS,gCAAgC;AACzC,SAAS,2BAA2B;AAEpC,SAAS,iCAAiC;AAC1C,SAAS,kCAAkC;AAE3C,mCAAmC,EAAE,aAAa,gBAAgB,CAAC;AAE5D,SAAS,cAAc,EAAE,UAAU,GAAG,MAAM,GAAwC;AACzF,QAAM,EAAE,+CAA+C,KAAK,IAAI;AAChE,QAAM,EAAE,KAAK,IAAI,UAAU;AAC3B,qBAAmB,cAAc;AAEjC,sBAAoB,MAAM;AACxB,WAAO,gCAAgC;AAAA,EACzC,GAAG,CAAC,CAAC;AAEL,sBAAoB,MAAM;AACxB,WAAO,+BAA+B,MAAM;AAI1C,UAAI,8CAA8C;AAChD,aAAK,KAAK,OAAO,SAAS,IAAI;AAAA,MAChC;AAAA,IACF;AAAA,EACF,GAAG,CAAC,CAAC;AAEL,QAAM,WAAW,CAAC,OAAe,KAAK,EAAE;AACxC,QAAM,cAAc,2BAA2B,EAAE,GAAG,OAAO,SAAS,CAAC;AAIrE,QAAM,eAAe,MAAM,qBAAqB,qBAAqB,MAAM;AAE3E,SACE,oCAAC,4BAAyB,SAAS,eAEjC;AAAA,IAAC;AAAA;AAAA,MACE,GAAG;AAAA,MACJ;AAAA;AAAA,IAEC;AAAA,EACH,CACF;AAEJ;","names":[]}